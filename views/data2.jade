extends layout

block content
  h1= title
  div.myDiv(id="output")

  style.
    .myDiv { height: 150px;overflow: scroll; float: center; }


  script.
      var wsUri = "ws://localhost:8080";
      function init()
      {
          output = document.getElementById("output");
      testWebSocket();

      }
      function testWebSocket()
      {
      websocket = new WebSocket(wsUri);
      websocket.onopen = function(evt) { onOpen(evt) };
      websocket.onclose = function(evt) { onClose(evt) };
      websocket.onmessage = function(evt) { onMessage(evt) };
      websocket.onerror = function(evt) { onError(evt) };
      }
      function onOpen(evt) { writeToScreen("CONNECTED to 8080");
          //   doSend("WebSocket rocks");
      }
      function onClose(evt) {
          writeToScreen("DISCONNECTED");
      }
      function onMessage(evt)    {
       // dp = JSON.parse(evt.data);
            writeToScreen(evt.data);

         // writeToScreen(dp[0].UnitID);
         //   graph();
          //websocket.close();
      }
      function onError(evt) {
          writeToScreen('<span style="color: red;">ERROR:</span> ' + evt.data);
      }
      function doSend(message) {
          writeToScreen("SENT: " + message);  websocket.send(message);
      }
      function writeToScreen(message) {

          output.innerHTML = message+"<BR>"+output.innerHTML;
      }
      window.addEventListener("load", init, false);